import{C as z,i as _,r as M,D as $,H as F,c as K,o,w as m,b as l,a as r,u as s,m as L,d as i,e as u,t as d,h as W,F as w,g as P,n as S,f as C,W as T}from"./app-ChGMDD_E.js";import{_ as G}from"./AppLayout-BmU85XNm.js";import{_ as v}from"./InputError-fR_UHGpi.js";import{_ as b}from"./InputLabel-a3I8QKJ8.js";import{_ as J}from"./PrimaryButton-DaXZvCnH.js";import{_ as q}from"./SecondaryButton-69yyfUBE.js";import{_ as I}from"./DangerButton-7MJ2IGXv.js";import{_ as Q}from"./TextInput-DQ9pP8sl.js";import{_ as V}from"./SelectInput-B9OojKbt.js";import{_ as X}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as Y}from"./format-dyE9oF1d.js";import"./normalizeDates-U9LyEZsq.js";const Z={class:"font-semibold text-xl text-gray-800 leading-tight"},ee={class:"py-6"},ae={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},se={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},te={class:"p-6 bg-white border-b border-gray-200"},ne={key:0,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},re={class:"grid grid-cols-1 gap-6"},oe=["disabled"],ie={key:0,class:"text-sm text-red-500 mt-1"},le=["value"],de={key:0,class:"text-sm text-red-500 mt-1"},pe={key:0},ue={value:""},me=["value"],ce={class:"text-sm text-gray-500 mt-1"},_e={key:0,class:"text-sm text-red-500 mt-1"},ge={key:1,class:"text-sm text-blue-500 mt-1"},ye={key:1},he={class:"flex justify-end space-x-3"},fe={key:0},ve={key:1},be={class:"mt-8"},xe={class:"mt-4 space-y-2"},ke={class:"font-medium"},we={class:"ml-2 text-sm text-gray-500"},Pe={key:0,class:"ml-2 text-sm text-gray-500"},Ce={key:0,class:"text-gray-500 p-3 border rounded"},Ve={__name:"Create",props:{person:Object,people:Array,existingRelationships:Array},setup(c){const p=c,e=z({person_id:p.person.id,related_person_id:"",type:"",marriage_date:null,parent_id:null,second_parent_id:null}),x=_(()=>p.existingRelationships.some(t=>t.type==="spouse")),k=_(()=>p.existingRelationships.some(t=>t.type==="ex_spouse")),y=M([]),h=M(!1),H=t=>({spouse:"Pasangan",ex_spouse:"Mantan Pasangan",parent:"Orang Tua"})[t]||t,g=_(()=>e.related_person_id?e.type==="child"?p.existingRelationships.filter(t=>["spouse","ex_spouse"].includes(t.type)).map(t=>({id:t.related_person.id,name:t.related_person.name,type:t.type})):e.type==="parent"?y.value:[]:[]);$(()=>e.related_person_id,async t=>{if(e.type!=="parent"||!t){y.value=[];return}try{h.value=!0;const a=await F.get(`/api/people/${t}/spouses`);y.value=a.data}catch(a){console.error("Gagal mengambil data pasangan:",a),y.value=[]}finally{h.value=!1}});const f=_(()=>x.value||k.value),B=_(()=>e.type==="child"||e.type==="parent"),R=_(()=>{let t=p.people.filter(a=>a.id!==p.person.id&&!p.existingRelationships.some(n=>n.related_person_id===a.id));if(["spouse","ex_spouse"].includes(e.type)){const a=p.person.gender==="male"?"female":"male";t=t.filter(n=>n.gender===a)}return t}),D=t=>({parent:"Orang Tua",child:"Anak",spouse:"Pasangan",ex_spouse:"Mantan Pasangan"})[t]||t,O=t=>t?Y(new Date(t),"dd MMMM yyyy"):null,j=()=>{e.parent_id=null,e.second_parent_id=null},E=()=>{const t={person_id:e.person_id,related_person_id:e.related_person_id,type:e.type,marriage_date:e.marriage_date,parent_id:e.type==="child"?e.parent_id:null,second_parent_id:e.type==="parent"?e.second_parent_id:null};console.log("Data yang dikirim:",t),e.post(route("relationships.store"),t,{preserveScroll:!0,onError:a=>{console.error("Error response:",a),window.scrollTo({top:0,behavior:"smooth"})},onSuccess:()=>{e.reset("related_person_id","type","marriage_date","parent_id","second_parent_id")}})},N=()=>{T.visit(route("people.show",p.person.id))},U=t=>{confirm("Apakah Anda yakin ingin menghapus hubungan ini?")&&T.delete(route("relationships.destroy",t.id),{preserveScroll:!0})};return $(()=>e.type,()=>{e.related_person_id="",e.parent_id=null,e.second_parent_id=null}),(t,a)=>(o(),K(G,null,{header:m(()=>[r("h2",Z," Tambah Hubungan Keluarga: "+d(c.person.name),1)]),default:m(()=>[l(s(L),{title:"Tambah Hubungan - "+c.person.name},null,8,["title"]),r("div",ee,[r("div",ae,[r("div",se,[r("div",te,[t.$page.props.errors.system?(o(),i("div",ne,d(t.$page.props.errors.system),1)):u("",!0),r("form",{onSubmit:W(E,["prevent"])},[r("div",re,[r("div",null,[l(b,{for:"type",value:"Jenis Hubungan"}),l(V,{id:"type",modelValue:s(e).type,"onUpdate:modelValue":a[0]||(a[0]=n=>s(e).type=n),class:"mt-1 block w-full",disabled:s(e).processing,onChange:a[1]||(a[1]=n=>s(e).related_person_id="")},{default:m(()=>[a[5]||(a[5]=r("option",{value:""},"Pilih Jenis Hubungan",-1)),a[6]||(a[6]=r("option",{value:"parent"},"Orang Tua",-1)),a[7]||(a[7]=r("option",{value:"child"},"Anak",-1)),r("option",{value:"spouse",disabled:c.person.gender==="female"&&x.value&&!k.value}," Pasangan ",8,oe),a[8]||(a[8]=r("option",{value:"ex_spouse"},"Mantan Pasangan",-1))]),_:1},8,["modelValue","disabled"]),l(v,{message:s(e).errors.type,class:"mt-2"},null,8,["message"]),c.person.gender==="female"&&x.value&&!k.value?(o(),i("p",ie," Wanita ini sudah memiliki pasangan. Harus menambahkan sebagai mantan pasangan terlebih dahulu sebelum menambahkan pasangan baru. ")):u("",!0)]),r("div",null,[l(b,{for:"related_person_id",value:"Anggota Keluarga"}),l(V,{id:"related_person_id",modelValue:s(e).related_person_id,"onUpdate:modelValue":a[2]||(a[2]=n=>s(e).related_person_id=n),class:"mt-1 block w-full",disabled:s(e).processing||s(e).type==="child"&&!f.value,options:{placeholder:"Cari anggota keluarga...",searchField:["text"]},onChange:j},{default:m(()=>[a[9]||(a[9]=r("option",{value:""},"Pilih Anggota Keluarga",-1)),(o(!0),i(w,null,P(R.value,n=>(o(),i("option",{key:n.id,value:n.id},d(n.name)+" ("+d(n.gender==="male"?"Laki-laki":"Perempuan")+") ",9,le))),128))]),_:1},8,["modelValue","disabled"]),l(v,{message:s(e).errors.related_person_id,class:"mt-2"},null,8,["message"]),s(e).type==="child"&&!f.value?(o(),i("p",de," Belum bisa menambahkan data anak, harus memiliki pasangan terlebih dahulu. ")):u("",!0)]),B.value&&s(e).related_person_id?(o(),i("div",pe,[l(b,{for:s(e).type==="child"?"parent_id":"second_parent_id",value:s(e).type==="child"?"Anak dari pasangan":"Pasangan orang tua"},null,8,["for","value"]),l(V,{id:s(e).type==="child"?"parent_id":"second_parent_id",modelValue:s(e)[s(e).type==="child"?"parent_id":"second_parent_id"],"onUpdate:modelValue":a[3]||(a[3]=n=>s(e)[s(e).type==="child"?"parent_id":"second_parent_id"]=n),class:"mt-1 block w-full",disabled:s(e).processing||g.value.length===0},{default:m(()=>[r("option",ue,"Pilih "+d(s(e).type==="child"?"pasangan":"orang tua")+" (opsional)",1),(o(!0),i(w,null,P(g.value,n=>(o(),i("option",{key:n.id,value:n.id},d(n.name)+" ("+d(H(n.type))+") ",9,me))),128))]),_:1},8,["id","modelValue","disabled"]),r("p",ce,d(s(e).type==="child"?"Pilih pasangan jika anak ini adalah hasil dari hubungan dengan pasangan tertentu":"Pilih pasangan orang tua untuk melengkapi data orang tua"),1),s(e).type==="parent"&&g.value.length===0&&!h.value?(o(),i("p",_e," Orang tua yang dipilih belum memiliki pasangan. ")):u("",!0),h.value?(o(),i("p",ge," Memuat data pasangan... ")):u("",!0),l(v,{message:s(e).errors.parent_id||s(e).errors.second_parent_id,class:"mt-2"},null,8,["message"])])):u("",!0),["spouse","ex_spouse"].includes(s(e).type)?(o(),i("div",ye,[l(b,{for:"marriage_date",value:"Tanggal Pernikahan"}),l(Q,{id:"marriage_date",modelValue:s(e).marriage_date,"onUpdate:modelValue":a[4]||(a[4]=n=>s(e).marriage_date=n),type:"date",class:"mt-1 block w-full",required:"",disabled:s(e).processing},null,8,["modelValue","disabled"]),l(v,{message:s(e).errors.marriage_date,class:"mt-2"},null,8,["message"])])):u("",!0),r("div",he,[l(q,{type:"button",onClick:N,disabled:s(e).processing,class:S({"opacity-50 cursor-not-allowed":s(e).processing})},{default:m(()=>a[10]||(a[10]=[C(" Batal ")])),_:1},8,["disabled","class"]),l(J,{disabled:s(e).processing||s(e).type==="child"&&!f.value||s(e).type==="parent"&&g.value.length===0,class:S({"opacity-75 cursor-not-allowed":s(e).processing||s(e).type==="child"&&!f.value||s(e).type==="parent"&&g.value.length===0})},{default:m(()=>[s(e).processing?(o(),i("span",fe,a[11]||(a[11]=[r("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[r("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),r("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),C(" Menyimpan... ")]))):(o(),i("span",ve," Tambah Hubungan "))]),_:1},8,["disabled","class"])])])],32),r("div",be,[a[13]||(a[13]=r("h3",{class:"text-lg font-medium text-gray-900"},"Hubungan yang Sudah Ada",-1)),r("div",xe,[(o(!0),i(w,null,P(c.existingRelationships,n=>{var A;return o(),i("div",{key:n.id,class:"p-3 border rounded flex justify-between items-center hover:bg-gray-50 transition-colors"},[r("div",null,[r("span",ke,d(n.related_person.name),1),r("span",we,"("+d(D(n.type))+")",1),n.marriage_id?(o(),i("span",Pe," Menikah pada "+d(O((A=n.marriage)==null?void 0:A.marriage_date)),1)):u("",!0)]),l(I,{onClick:Ae=>U(n),class:"text-sm",disabled:s(e).processing},{default:m(()=>a[12]||(a[12]=[C(" Hapus ")])),_:2},1032,["onClick","disabled"])])}),128)),c.existingRelationships.length===0?(o(),i("p",Ce," Belum ada hubungan yang ditambahkan.A ")):u("",!0)])])])])])])]),_:1}))}},Ue=X(Ve,[["__scopeId","data-v-4ca19b4c"]]);export{Ue as default};
