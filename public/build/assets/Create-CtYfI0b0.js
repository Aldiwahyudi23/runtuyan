import{C as E,i as g,E as O,c as j,o,w as u,b as r,a as i,u as s,m as N,d as l,e as m,t as p,h as U,F as x,g as k,n as C,f as w,W as A}from"./app-BUhXKvy-.js";import{_ as z}from"./AppLayout-Bds4WRr8.js";import{_ as h}from"./InputError-LFjDoR_r.js";import{_ as f}from"./InputLabel-QbamSF45.js";import{_ as F}from"./PrimaryButton-CYowRUI1.js";import{_ as K}from"./SecondaryButton-j8km-T-4.js";import{_ as W}from"./DangerButton-BvqvQc3p.js";import{_ as J}from"./TextInput-CA3sBhT7.js";import{_ as P}from"./SelectInput-zgsvOgh7.js";import{_ as L}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{f as q}from"./format-CkpID6nj.js";const G={class:"font-semibold text-xl text-gray-800 leading-tight"},I={class:"py-6"},Q={class:"max-w-7xl mx-auto sm:px-6 lg:px-8"},X={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Y={class:"p-6 bg-white border-b border-gray-200"},Z={key:0,class:"mb-4 p-4 bg-red-100 border border-red-400 text-red-700 rounded"},ee={class:"grid grid-cols-1 gap-6"},ae=["disabled"],se={key:0,class:"text-sm text-red-500 mt-1"},te=["value"],ne={key:0,class:"text-sm text-red-500 mt-1"},ie={key:0},oe={value:""},re=["value"],le={class:"text-sm text-gray-500 mt-1"},de={key:0,class:"text-sm text-red-500 mt-1"},pe={key:1},ue={class:"flex justify-end space-x-3"},me={key:0},_e={key:1},ge={class:"mt-8"},ce={class:"mt-4 space-y-2"},ye={class:"font-medium"},he={class:"ml-2 text-sm text-gray-500"},fe={key:0,class:"ml-2 text-sm text-gray-500"},be={key:0,class:"text-gray-500 p-3 border rounded"},ve={__name:"Create",props:{person:Object,people:Array,existingRelationships:Array},setup(_){const d=_,e=E({person_id:d.person.id,related_person_id:"",type:"",marriage_date:null,parent_id:null,second_parent_id:null}),b=g(()=>d.existingRelationships.some(t=>t.type==="spouse")),v=g(()=>d.existingRelationships.some(t=>t.type==="ex_spouse")),c=g(()=>{if(!e.related_person_id)return[];if(e.type==="child")return d.existingRelationships.filter(t=>["spouse","ex_spouse"].includes(t.type)).map(t=>({id:t.related_person.id,name:t.related_person.name,type:t.type}));if(e.type==="parent"){const t=d.people.find(a=>a.id==e.related_person_id);return t?d.existingRelationships.filter(a=>a.id===t.id&&["spouse","ex_spouse"].includes(a.type)).map(a=>({id:a.related_person.id,name:a.related_person.name,type:a.type})):[]}return[]}),y=g(()=>b.value||v.value),M=g(()=>e.type==="child"||e.type==="parent"),$=g(()=>{let t=d.people.filter(a=>a.id!==d.person.id&&!d.existingRelationships.some(n=>n.related_person_id===a.id));if(["spouse","ex_spouse"].includes(e.type)){const a=d.person.gender==="male"?"female":"male";t=t.filter(n=>n.gender===a)}return t}),S=t=>({parent:"Orang Tua",child:"Anak",spouse:"Pasangan",ex_spouse:"Mantan Pasangan"})[t]||t,T=t=>t?q(new Date(t),"dd MMMM yyyy"):null,B=()=>{e.parent_id=null,e.second_parent_id=null},H=()=>{const t={person_id:e.person_id,related_person_id:e.related_person_id,type:e.type,marriage_date:e.marriage_date,parent_id:e.type==="child"?e.parent_id:null,second_parent_id:e.type==="parent"?e.second_parent_id:null};console.log("Data yang dikirim:",t),e.post(route("relationships.store"),t,{preserveScroll:!0,onError:a=>{console.error("Error response:",a),window.scrollTo({top:0,behavior:"smooth"})},onSuccess:()=>{e.reset("related_person_id","type","marriage_date","parent_id","second_parent_id")}})},R=()=>{A.visit(route("people.show",d.person.id))},D=t=>{confirm("Apakah Anda yakin ingin menghapus hubungan ini?")&&A.delete(route("relationships.destroy",t.id),{preserveScroll:!0})};return O(()=>e.type,()=>{e.related_person_id="",e.parent_id=null,e.second_parent_id=null}),(t,a)=>(o(),j(z,null,{header:u(()=>[i("h2",G," Tambah Hubungan Keluarga: "+p(_.person.name),1)]),default:u(()=>[r(s(N),{title:"Tambah Hubungan - "+_.person.name},null,8,["title"]),i("div",I,[i("div",Q,[i("div",X,[i("div",Y,[t.$page.props.errors.system?(o(),l("div",Z,p(t.$page.props.errors.system),1)):m("",!0),i("form",{onSubmit:U(H,["prevent"])},[i("div",ee,[i("div",null,[r(f,{for:"type",value:"Jenis Hubungan"}),r(P,{id:"type",modelValue:s(e).type,"onUpdate:modelValue":a[0]||(a[0]=n=>s(e).type=n),class:"mt-1 block w-full",disabled:s(e).processing,onChange:a[1]||(a[1]=n=>s(e).related_person_id="")},{default:u(()=>[a[5]||(a[5]=i("option",{value:""},"Pilih Jenis Hubungan",-1)),a[6]||(a[6]=i("option",{value:"parent"},"Orang Tua",-1)),a[7]||(a[7]=i("option",{value:"child"},"Anak",-1)),i("option",{value:"spouse",disabled:_.person.gender==="female"&&b.value&&!v.value}," Pasangan ",8,ae),a[8]||(a[8]=i("option",{value:"ex_spouse"},"Mantan Pasangan",-1))]),_:1},8,["modelValue","disabled"]),r(h,{message:s(e).errors.type,class:"mt-2"},null,8,["message"]),_.person.gender==="female"&&b.value&&!v.value?(o(),l("p",se," Wanita ini sudah memiliki pasangan. Harus menambahkan sebagai mantan pasangan terlebih dahulu sebelum menambahkan pasangan baru. ")):m("",!0)]),i("div",null,[r(f,{for:"related_person_id",value:"Anggota Keluarga"}),r(P,{id:"related_person_id",modelValue:s(e).related_person_id,"onUpdate:modelValue":a[2]||(a[2]=n=>s(e).related_person_id=n),class:"mt-1 block w-full",disabled:s(e).processing||s(e).type==="child"&&!y.value,options:{placeholder:"Cari anggota keluarga...",searchField:["text"]},onChange:B},{default:u(()=>[a[9]||(a[9]=i("option",{value:""},"Pilih Anggota Keluarga",-1)),(o(!0),l(x,null,k($.value,n=>(o(),l("option",{key:n.id,value:n.id},p(n.name)+" ("+p(n.gender==="male"?"Laki-laki":"Perempuan")+") ",9,te))),128))]),_:1},8,["modelValue","disabled"]),r(h,{message:s(e).errors.related_person_id,class:"mt-2"},null,8,["message"]),s(e).type==="child"&&!y.value?(o(),l("p",ne," Belum bisa menambahkan data anak, harus memiliki pasangan terlebih dahulu. ")):m("",!0)]),M.value&&s(e).related_person_id?(o(),l("div",ie,[r(f,{for:s(e).type==="child"?"parent_id":"second_parent_id",value:s(e).type==="child"?"Anak dari pasangan":"Pasangan orang tua"},null,8,["for","value"]),r(P,{id:s(e).type==="child"?"parent_id":"second_parent_id",modelValue:s(e)[s(e).type==="child"?"parent_id":"second_parent_id"],"onUpdate:modelValue":a[3]||(a[3]=n=>s(e)[s(e).type==="child"?"parent_id":"second_parent_id"]=n),class:"mt-1 block w-full",disabled:s(e).processing||c.value.length===0},{default:u(()=>[i("option",oe,"Pilih "+p(s(e).type==="child"?"pasangan":"orang tua")+" (opsional)",1),(o(!0),l(x,null,k(c.value,n=>(o(),l("option",{key:n.id,value:n.id},p(n.name)+" ("+p(n.type==="spouse"?"Pasangan":n.type==="parent"?"Orang Tua":"Mantan Pasangan")+") ",9,re))),128))]),_:1},8,["id","modelValue","disabled"]),i("p",le,p(s(e).type==="child"?"Pilih pasangan jika anak ini adalah hasil dari hubungan dengan pasangan tertentu":"Pilih pasangan orang tua untuk melengkapi data orang tua"),1),s(e).type==="parent"&&c.value.length===0?(o(),l("p",de," Orang tua yang dipilih belum memiliki pasangan. ")):m("",!0),r(h,{message:s(e).errors.parent_id||s(e).errors.second_parent_id,class:"mt-2"},null,8,["message"])])):m("",!0),["spouse","ex_spouse"].includes(s(e).type)?(o(),l("div",pe,[r(f,{for:"marriage_date",value:"Tanggal Pernikahan"}),r(J,{id:"marriage_date",modelValue:s(e).marriage_date,"onUpdate:modelValue":a[4]||(a[4]=n=>s(e).marriage_date=n),type:"date",class:"mt-1 block w-full",required:"",disabled:s(e).processing},null,8,["modelValue","disabled"]),r(h,{message:s(e).errors.marriage_date,class:"mt-2"},null,8,["message"])])):m("",!0),i("div",ue,[r(K,{type:"button",onClick:R,disabled:s(e).processing,class:C({"opacity-50 cursor-not-allowed":s(e).processing})},{default:u(()=>a[10]||(a[10]=[w(" Batal ")])),_:1},8,["disabled","class"]),r(F,{disabled:s(e).processing||s(e).type==="child"&&!y.value||s(e).type==="parent"&&c.value.length===0,class:C({"opacity-75 cursor-not-allowed":s(e).processing||s(e).type==="child"&&!y.value||s(e).type==="parent"&&c.value.length===0})},{default:u(()=>[s(e).processing?(o(),l("span",me,a[11]||(a[11]=[i("svg",{class:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[i("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),i("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1),w(" Menyimpan... ")]))):(o(),l("span",_e," Tambah Hubungan "))]),_:1},8,["disabled","class"])])])],32),i("div",ge,[a[13]||(a[13]=i("h3",{class:"text-lg font-medium text-gray-900"},"Hubungan yang Sudah Ada",-1)),i("div",ce,[(o(!0),l(x,null,k(_.existingRelationships,n=>{var V;return o(),l("div",{key:n.id,class:"p-3 border rounded flex justify-between items-center hover:bg-gray-50 transition-colors"},[i("div",null,[i("span",ye,p(n.related_person.name),1),i("span",he,"("+p(S(n.type))+")",1),n.marriage_id?(o(),l("span",fe," Menikah pada "+p(T((V=n.marriage)==null?void 0:V.marriage_date)),1)):m("",!0)]),r(W,{onClick:xe=>D(n),class:"text-sm",disabled:s(e).processing},{default:u(()=>a[12]||(a[12]=[w(" Hapus ")])),_:2},1032,["onClick","disabled"])])}),128)),_.existingRelationships.length===0?(o(),l("p",be," Belum ada hubungan yang ditambahkan.A ")):m("",!0)])])])])])])]),_:1}))}},He=L(ve,[["__scopeId","data-v-2d114562"]]);export{He as default};
